package ${basePackage}.controller;
import ${corePackage}.results.Result;
import ${corePackage}.results.ResultGenerator;
import ${basePackage}.entity.${table.entityName};
import ${basePackage}.service.${table.entityName}Service;
import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.apache.shiro.authz.annotation.RequiresPermissions;
import org.springframework.web.bind.annotation.*;
import io.swagger.annotations.*;
import tk.mybatis.mapper.entity.Condition;
import tk.mybatis.mapper.entity.Example;
import org.apache.commons.lang.StringUtils;
import java.util.List;

/**
 * @Title: ${table.entityName}Controller
 * @ProjectName
 * @Description: TODO
 * @author ${author}
 * @date ${date()}
 */
@RestController
@RequestMapping("${table.mappingPath}")
public class ${table.entityName}Controller {
    @Autowired
    private ${table.entityName}Service ${table.entityName}Service;

    @RequiresPermissions("bg:${strutil.toLowerCase(table.entityName)}")
    @PostMapping
    @ApiOperation("添加${table.entityName}")
    public Result add(${table.entityName} ${table.entityName}) {
        ${table.entityName}Service.save(${table.entityName});
        return ResultGenerator.genSuccessResult();
    }



    /**
    * 批量删除
    * @param checkIds
    * @return
    */
    @RequiresPermissions("bg:${strutil.toLowerCase(table.entityName)}")
    @GetMapping("delpl")
    public Result delpl(String checkIds) {
        if(StringUtils.isEmpty(checkIds)){
            return ResultGenerator.genFailResult("数据为空!");
        }
        try{
            ${table.entityName}Service.deleteByIds(checkIds);
        }catch (Exception e){
            return ResultGenerator.genFailResult("所选数据已被关联无法删除");
        }
        return ResultGenerator.genSuccessResult();
    }



    @RequiresPermissions("bg:${strutil.toLowerCase(table.entityName)}")
    @PutMapping("/{id:\\d+}")
    @ApiOperation("修改${table.entityName}")
    public Result update(${table.entityName} ${table.entityName}) {
        ${table.entityName}Service.update(${table.entityName});
        return ResultGenerator.genSuccessResult();
    }

    @RequiresPermissions("bg:${strutil.toLowerCase(table.entityName)}")
    @GetMapping("/{id:\\d+}")
    @ApiOperation("${table.entityName}根据id查询详情")
    public Result detail(@ApiParam(value = "${table.remarks}id")@PathVariable Integer id) {
        ${table.entityName} ${table.entityName} = ${table.entityName}Service.findById(id);
        return ResultGenerator.genSuccessResult(${table.entityName});
    }


    @RequiresPermissions("bg:${strutil.toLowerCase(table.entityName)}")
    @GetMapping
    @ApiOperation("${table.entityName}分页查询列表")
    public Result list(<%for(item in table.columnModels){%><%if(item.isChoose){%>@ApiParam(value = "${item.remarks}")@RequestParam(name = "${item.columnNameLowerCamel}",defaultValue = "") ${item.javaType} ${item.columnNameLowerCamel},<%}}%>
                        @ApiParam(value = "页数")@RequestParam(name = "page",defaultValue = "1") Integer page,
                        @ApiParam(value = "每页行数")@RequestParam(name = "size",defaultValue = "10") Integer size) {
        PageHelper.startPage(page, size);
        Condition condition=new Condition(${table.entityName}.class);
        Example.Criteria criteria = condition.createCriteria();
        <%for(item in table.columnModels){%>
        <%if(item.isChoose){%>
        <%if(item.javaType=="String"){%>
        if(StringUtils.isNotEmpty(${item.columnNameLowerCamel})){
            criteria.andLike("${item.columnNameLowerCamel}","%"+${item.columnNameLowerCamel}+"%");
        }
        <%}else{%>
        <%}}}%>
        List<${table.entityName}> list = ${table.entityName}Service.findByCondition(condition);
        PageInfo pageInfo = new PageInfo(list);
        return ResultGenerator.genSuccessResult(pageInfo);
    }
}
